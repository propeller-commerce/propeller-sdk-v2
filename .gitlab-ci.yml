# GitLab CI/CD Configuration
# This pipeline automatically mirrors the repository to GitHub

stages:
  - mirror

# Mirror to GitHub
# This job runs whenever code is pushed to develop or main branches
mirror_to_github:
  stage: mirror
  image: ubuntu:22.04
  only:
    - develop
    - main
    - master
  before_script:
    - apt-get update -qq && apt-get install -y -qq git
    - git --version
  script:
    - echo "Mirroring to GitHub..."
    - git config --global user.email "ci@propeller-commerce.com"
    - git config --global user.name "GitLab CI"
    - git remote add github https://${GITHUB_TOKEN}@github.com/propeller-commerce/propeller-sdk-v2.git || true
    - git fetch --unshallow || git fetch --all
    - git push github HEAD:${CI_COMMIT_REF_NAME} --force --tags
  when: on_success
  allow_failure: false

# Optional: Mirror all branches (not just develop/main)
# Uncomment this job if you want to sync ALL branches
# mirror_all_branches:
#   stage: mirror
#   image: alpine/git:latest
#   only:
#     - branches
#   except:
#     - develop
#     - main
#     - master
#   script:
#     - echo "Mirroring branch ${CI_COMMIT_REF_NAME} to GitHub..."
#     - git config --global user.email "ci@propeller-commerce.com"
#     - git config --global user.name "GitLab CI"
#     - git remote add github https://${GITHUB_TOKEN}@github.com/propeller-commerce/propeller-sdk-v2.git || true
#     - git fetch --unshallow || git fetch --all
#     - git push github HEAD:${CI_COMMIT_REF_NAME} --force
#   when: manual

